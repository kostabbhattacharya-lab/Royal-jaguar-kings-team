<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Royal Jaguar Kings - Official Team Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box;}

        body{
            font-family:'Poppins',sans-serif;
            background:radial-gradient(circle at top,#020617 0,#020617 40%,#000311 100%);
            color:#e5e7eb;
            line-height:1.6;
        }

        .container{
            max-width:1120px;
            margin:0 auto;
            padding:16px;
        }

        /* HEADER + NAV */
        header{
            background:linear-gradient(135deg,#020617,#020617 40%,#0b1220 100%);
            border-bottom:1px solid rgba(148,163,184,0.5);
            position:sticky;
            top:0;
            z-index:50;
            box-shadow:0 10px 30px rgba(0,0,0,0.7);
        }

        .header-inner{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            padding-top:8px;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:12px;
        }

        .brand-logo{
            width:56px;
            height:56px;
            border-radius:18px;
            overflow:hidden;
            border:2px solid #facc15;
            background:#020617;
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;
            box-shadow:0 0 22px rgba(250,204,21,0.5);
        }
        .brand-logo img{
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .brand-logo-fallback{
            font-weight:700;
            font-size:18px;
            font-family:'Bebas Neue',system-ui;
            letter-spacing:0.16em;
        }

        .brand-text h1{
            font-size:20px;
            letter-spacing:0.18em;
            text-transform:uppercase;
            font-family:'Bebas Neue',system-ui;
        }
        .brand-text p{
            font-size:11px;
            color:#9ca3af;
        }

        nav{
            margin-top:10px;
            padding-bottom:10px;
        }

        .nav-links{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
        }
        .nav-links a{
            text-decoration:none;
            color:#e5e7eb;
            font-size:13px;
            padding:6px 12px;
            border-radius:999px;
            border:1px solid transparent;
            transition:all 0.18s ease;
        }
        .nav-links a:hover{
            color:#facc15;
            border-color:rgba(250,204,21,0.4);
            background:rgba(15,23,42,0.9);
        }
        .nav-links a.active{
            background:#facc15;
            color:#020617;
            border-color:#facc15;
            font-weight:600;
        }

        /* HERO */
        .hero{
    margin-top:10px;
    position:relative;
    border-radius:22px;
    overflow:visible;  
    min-height:230px;
    background:
        linear-gradient(135deg,rgba(15,23,42,0.92),rgba(15,23,42,0.7)),
        url("https://images.pexels.com/photos/26994840/pexels-photo-26994840/free-photo-of-wide-angle-view-of-scoreboard-and-cricket-field.jpeg")
        center/cover no-repeat;
}
        .hero::before{
            content:"";
            position:absolute;
            inset:0;
            background:
                radial-gradient(circle at top,rgba(250,204,21,0.18),transparent 55%),
                linear-gradient(to bottom,rgba(0,0,0,0.5),rgba(0,0,0,0.85));
        }
        .hero-inner{
            position:relative;
            padding:26px 20px 22px;
            display:flex;
            flex-direction:column;
            gap:14px;
        }
        .hero-text{
            max-width:720px;
        }
        .hero-kicker{
            font-size:11px;
            letter-spacing:0.26em;
            text-transform:uppercase;
            color:#facc15;
            margin-bottom:6px;
        }
        .hero-title{
            font-family:'Bebas Neue',system-ui;
            font-size:32px;
            letter-spacing:0.18em;
            text-transform:uppercase;
            margin-bottom:6px;
        }
        .hero-subtitle{
            font-size:13px;
            color:#e5e7eb;
        }
        .hero-buttons{
            margin-top:16px;
            display:flex;
            flex-wrap:wrap;
            gap:10px;
        }
        .btn{
            border-radius:999px;
            padding:8px 18px;
            font-size:13px;
            border:1px solid transparent;
            text-decoration:none;
            display:inline-flex;
            align-items:center;
            gap:6px;
            cursor:pointer;
            transition:all 0.18s ease;
        }
        .btn-primary{
            background:#facc15;
            color:#020617;
            border-color:#facc15;
            font-weight:600;
        }
        .btn-primary:hover{
            filter:brightness(1.05);
            box-shadow:0 16px 40px rgba(250,204,21,0.35);
        }
        .btn-ghost{
            background:rgba(15,23,42,0.92);
            color:#e5e7eb;
            border-color:rgba(148,163,184,0.45);
        }
        .btn-ghost:hover{
            border-color:#facc15;
            color:#facc15;
        }

        /* TOP PLAYER SEARCH (in hero) */
        .hero-search-wrap{
            margin-top:10px;
            max-width:520px;
        }
        .hero-search-label{
            font-size:11px;
            text-transform:uppercase;
            letter-spacing:0.12em;
            color:#9ca3af;
            margin-bottom:4px;
        }
        .hero-search-inner{
            position:relative;
            border-radius:999px;
            padding:1px;
            background:linear-gradient(120deg,rgba(56,189,248,0.7),rgba(45,212,191,0.4),rgba(129,140,248,0.7));
        }
        .hero-search-body{
            display:flex;
            align-items:center;
            background:#020617;
            border-radius:999px;
            padding:2px 2px 2px 10px;
        }
        .hero-search-input{
            flex:1;
            border:none;
            outline:none;
            background:transparent;
            color:#e5e7eb;
            font-size:12px;
            padding:6px 4px;
        }
        .hero-search-input::placeholder{
            color:#6b7280;
        }
        .hero-search-button{
            border:none;
            border-radius:999px;
            padding:6px 12px;
            font-size:12px;
            text-transform:uppercase;
            letter-spacing:0.08em;
            background:#facc15;
            color:#020617;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:4px;
        }
        .hero-search-button span.icon{
            font-size:12px;
        }

        .hero-search-suggestions{
            position:relative;
        }
        .hero-search-suggestions-list{
            position:absolute;
            top:100%;
            left:0;
            right:0;
            margin-top:4px;
            background:rgba(15,23,42,0.98);
            border-radius:14px;
            border:1px solid rgba(55,65,81,0.9);
            max-height:220px;
            overflow:auto;
            box-shadow:0 18px 40px rgba(0,0,0,0.85);
            z-index:40;
            display:none;
        }
        .hero-search-suggestions-list.visible{
            display:block;
        }
        .hero-suggestion-item{
            display:flex;
            align-items:center;
            gap:8px;
            padding:6px 9px;
            cursor:pointer;
            font-size:12px;
            border-bottom:1px solid rgba(31,41,55,0.85);
        }
        .hero-suggestion-item:last-child{
            border-bottom:none;
        }
        .hero-suggestion-item:hover{
            background:rgba(8,47,73,0.95);
        }
        .hero-suggestion-photo{
            width:26px;
            height:26px;
            border-radius:50%;
            overflow:hidden;
            background:#020617;
            flex-shrink:0;
        }
        .hero-suggestion-photo img{
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .hero-suggestion-text{
            display:flex;
            flex-direction:column;
        }
        .hero-suggestion-name{
            font-size:12px;
        }
        .hero-suggestion-team{
            font-size:10px;
            color:#9ca3af;
        }

        /* SECTIONS */
        .section{
            margin-top:24px;
            background:#020617;
            border-radius:18px;
            border:1px solid #1f2937;
            padding:18px;
            box-shadow:0 18px 40px rgba(15,23,42,0.85);
        }
        .section-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:10px;
            margin-bottom:10px;
        }
        .section-title{
            font-size:18px;
            display:flex;
            align-items:center;
            gap:8px;
        }
        .section-title span.bar{
            width:3px;
            height:18px;
            border-radius:999px;
            background:linear-gradient(to bottom,#facc15,#22c55e);
        }
        .section-subtitle{
            font-size:12px;
            color:#9ca3af;
        }

        .home-grid{
            margin-top:10px;
            display:grid;
            grid-template-columns:minmax(0,1.6fr) minmax(0,1fr);
            gap:16px;
        }

        .card{
            background:radial-gradient(circle at top left,rgba(15,23,42,0.9),#020617);
            border-radius:14px;
            border:1px solid #1f2937;
            padding:14px;
        }

        .card h4{
            font-size:15px;
            margin-bottom:6px;
            color:#facc15;
        }
        .card p{
            font-size:13px;
            color:#d1d5db;
        }

        .pill{
            display:inline-block;
            padding:3px 9px;
            border-radius:999px;
            border:1px solid #4b5563;
            font-size:11px;
            margin-right:4px;
            margin-top:4px;
        }

        /* TEAM STATS OVERVIEW */
        .stat-grid{
            display:grid;
            grid-template-columns:repeat(2,minmax(0,1fr));
            gap:10px;
            margin-top:8px;
        }
        .stat{
            padding:8px 10px;
            border-radius:12px;
            background:radial-gradient(circle at top left,rgba(250,204,21,0.18),#020617);
            border:1px solid rgba(148,163,184,0.6);
        }
        .stat-label{
            font-size:11px;
            color:#9ca3af;
        }
        .stat-value{
            font-size:15px;
            font-weight:600;
        }

        /* TOP PERFORMERS PANEL */
        .leader-layout{
            display:grid;
            grid-template-columns:minmax(0,1.2fr) minmax(0,1.4fr);
            gap:14px;
            margin-top:8px;
        }

        .leader-card{
            background:#020617;
            border-radius:14px;
            border:1px solid #1f2937;
            padding:12px;
        }

        .leader-form{
            display:flex;
            flex-wrap:wrap;
            gap:10px;
            margin-bottom:10px;
        }

        .field{
            display:flex;
            flex-direction:column;
            gap:4px;
            flex:1;
            min-width:120px;
        }
        .field label{
            font-size:11px;
            color:#9ca3af;
            text-transform:uppercase;
            letter-spacing:0.08em;
        }
        select,
        .search-input{
            border-radius:999px;
            border:1px solid #374151;
            background:#020617;
            color:#e5e7eb;
            font-size:12px;
            padding:7px 10px;
            outline:none;
            transition:all 0.18s ease;
        }
        select:focus,
        .search-input:focus{
            border-color:#0ea5e9;
            box-shadow:0 0 0 1px rgba(56,189,248,0.7);
        }

        /* Player-style leaderboard rows */
        .leaders-list{
            margin-top:4px;
        }
        .leader-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:8px;
            padding:7px 9px;
            border-radius:12px;
            background:rgba(15,23,42,0.9);
            margin-bottom:6px;
            font-size:12px;
            border:1px solid rgba(31,41,55,0.95);
            transition:transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
        }
        .leader-row:hover{
            transform:translateY(-2px);
            border-color:#38bdf8;
            box-shadow:0 12px 30px rgba(15,23,42,0.9);
        }

        .leader-left{
            display:flex;
            align-items:center;
            gap:8px;
            flex:1;
        }
        .leader-rank{
            width:22px;
            height:22px;
            border-radius:8px;
            font-size:11px;
            display:flex;
            align-items:center;
            justify-content:center;
            background:linear-gradient(135deg,#22c55e,#0ea5e9);
            color:#020617;
            font-weight:700;
            flex-shrink:0;
        }
        .leader-photo{
            width:38px;
            height:38px;
            border-radius:12px;
            overflow:hidden;
            background:#020617;
            border:1px solid #4b5563;
            flex-shrink:0;
        }
        .leader-photo img{
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .leader-text{
            flex:1;
        }
        .leader-name{
            font-size:13px;
            font-weight:600;
        }
        .leader-role{
            font-size:11px;
            color:#9ca3af;
        }

        .leader-right{
            text-align:right;
            min-width:80px;
        }
        .leader-value{
            font-size:14px;
            font-weight:600;
        }
        .leader-metric-label{
            font-size:10px;
            color:#9ca3af;
            text-transform:uppercase;
            letter-spacing:0.08em;
        }

        .leader-empty{
            font-size:11px;
            color:#9ca3af;
            margin-top:4px;
        }

        .mini-legend{
            font-size:12px;
            color:#9ca3af;
            margin-top:6px;
        }

        footer{
            text-align:center;
            padding:18px 0 22px;
            font-size:11px;
            color:#9ca3af;
            margin-top:26px;
        }

        @media (max-width:900px){
            .home-grid{grid-template-columns:1fr;}
            .leader-layout{grid-template-columns:1fr;}
        }
        @media (max-width:768px){
            .header-inner{
                flex-direction:column;
                align-items:flex-start;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="container header-inner">
        <div class="brand">
            <div class="brand-logo">
                <span class="brand-logo-fallback">RJK</span>
            </div>
            <div class="brand-text">
                <h1>Royal Jaguar Kings</h1>
                <p>Official Cricket Team ‚Ä¢ Since 2025</p>
            </div>
        </div>

        <nav>
            <div class="nav-links">
                <a href="index.html" class="active">Home</a>
                <a href="players.html">Players</a>
                <a href="tournament.html">Tournament</a>
            </div>
        </nav>
    </div>
</header>

<section class="hero">
    <div class="hero-inner container">
        <div class="hero-text">
            <div class="hero-kicker">Royal Jaguar Kings ‚Ä¢ Cricket</div>
            <div class="hero-title">Rule the Game. Hunt the Victory.</div>
            <p class="hero-subtitle">
                High-intensity cricket powered by fearless batting, smart bowling plans and sharp fielding.
                This is the official hub for the Royal Jaguar Kings squad and stats.
            </p>

            <div class="hero-buttons">
                <a href="players.html" class="btn btn-primary">View Players & Stats</a>
                <a href="tournament.html" class="btn btn-ghost">RJKPL Season 5</a>
            </div>

            <!-- üîç TOP PLAYER SEARCH -->
            <div class="hero-search-wrap">
                <div class="hero-search-label">Quick player search</div>
                <div class="hero-search-inner">
                    <div class="hero-search-body">
                        <input
                            id="home-player-search"
                            class="hero-search-input"
                            type="text"
                            autocomplete="off"
                            placeholder="Type a player name (e.g. Akash, Akashdeep)...">
                        <button id="home-search-btn" class="hero-search-button">
                            <span class="icon">üîç</span>
                            <span>Search</span>
                        </button>
                    </div>
                </div>
                <div class="hero-search-suggestions">
                    <div id="home-search-suggestions" class="hero-search-suggestions-list">
                        <!-- suggestions by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<main class="container">

    <!-- ABOUT + TEAM SNAPSHOT -->
    <section class="section">
        <div class="section-header">
            <div class="section-title">
                <span class="bar"></span>
                <span>About Royal Jaguar Kings</span>
            </div>
            <div class="section-subtitle">
                Identity ‚Ä¢ Style ‚Ä¢ Quick overview
            </div>
        </div>

        <div class="home-grid">
            <div class="card">
                <h4>Team Identity</h4>
                <p>
                    Royals in mindset, jaguars in instinct and kings on the scoreboard.
                    The squad backs aggressive intent with discipline, trust and clear roles.
                    Every match is treated like a final, every over is played with purpose.
                </p>
                <div style="margin-top:8px;">
                    <span class="pill">Attacking batting</span>
                    <span class="pill">Planned bowling</span>
                    <span class="pill">High fielding energy</span>
                </div>
            </div>

            <div class="card">
                <h4>Team Season Snapshot</h4>
                <p style="font-size:12px;color:#9ca3af;">All numbers are currently set to 0. You can update them later.</p>
                <div class="stat-grid">
                    <div class="stat">
                        <div class="stat-label">Matches Played</div>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Matches Won</div>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Runs Scored</div>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Wickets Taken</div>
                        <div class="stat-value">0</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- TOP PERFORMERS / LEADERBOARD -->
    <section class="section">
        <div class="section-header">
            <div class="section-title">
                <span class="bar"></span>
                <span>Top Performers Preview</span>
            </div>
            <div class="section-subtitle">
                All-time leaders ‚Äì powered directly by your Players page stats
            </div>
        </div>

        <div class="leader-layout">
            <!-- LEFT: CONTROLS -->
            <div class="leader-card">
                <h4>Leaderboards (All-time)</h4>
                <p style="font-size:12px;color:#9ca3af;margin-bottom:8px;">
                    First choose the type of stats (batting, bowling or fielding). Then choose which metric you want
                    to see. The list on the right will show rank 1, 2, 3‚Ä¶ with player photo, name and value.
                </p>

                <div class="leader-form">
                    <div class="field">
                        <label for="mode-select">Stat type</label>
                        <select id="mode-select">
                            <option value="batting">Batting</option>
                            <option value="bowling">Bowling</option>
                            <option value="fielding">Fielding</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="metric-select">Metric</label>
                        <select id="metric-select"></select>
                    </div>

                    <div class="field">
                        <label for="leader-search">Search player (optional)</label>
                        <input id="leader-search" class="search-input" type="text" placeholder="Filter by player name...">
                    </div>
                </div>

                <div class="mini-legend">
                    All numbers come from the same stats that you edit once in
                    <strong>players.html</strong>. No need to update anything separately on the home page.
                </div>
            </div>

            <!-- RIGHT: LIST -->
            <div class="leader-card">
                <h4 id="leaders-title">Most Runs</h4>
                <div class="leaders-list" id="leaders-list">
                    <!-- Filled by JS -->
                </div>
                <div class="leader-empty" id="leaders-empty">
                    No leaders yet. Update your player stats in <strong>players.html</strong> to see the ranked list
                    with photos and values here.
                </div>
            </div>
        </div>
    </section>

    <!-- LINKS -->
    <section class="section">
        <div class="section-header">
            <div class="section-title">
                <span class="bar"></span>
                <span>Next Actions</span>
            </div>
            <div class="section-subtitle">
                Jump into players or the tournament centre
            </div>
        </div>

        <div class="home-grid">
            <div class="card">
                <h4>Explore the Squad</h4>
                <p>
                    Open the Players page to see each player‚Äôs dedicated profile card, all-time stats and breakdowns.
                    Batting, bowling and fielding numbers auto-calculate key metrics such as averages and strike rates.
                </p>
                <p style="margin-top:10px;">
                    <a href="players.html" class="btn btn-primary">Go to Players page</a>
                </p>
            </div>

            <div class="card">
                <h4>RJKPL ‚Äì Tournament Hub</h4>
                <p>
                    Visit the Tournament page to see teams, logos, fixtures and premium match cards.
                    Squads and fixtures follow the same design language as this home page for a unified feel.
                </p>
                <p style="margin-top:10px;">
                    <a href="tournament.html" class="btn btn-ghost">Open Tournament details</a>
                </p>
            </div>
        </div>
    </section>

</main>

<footer>
    ¬© 2025 Royal Jaguar Kings Cricket Team. All rights reserved.
</footer>

<script>
/*
   This home page:
   - Fetches players from players.html (JSON in <script id="players-data">)
   - Builds:
       ‚Ä¢ Top Player Search (hero)
       ‚Ä¢ All-time leaderboards (batting / bowling / fielding)
*/

const DEFAULT_PHOTO = "https://raw.githubusercontent.com/kostabbhattacharya-lab/Royal-jaguar-kings-team/refs/heads/main/boy-icon-png-10.jpg";

const battingMetrics = [
  { key: "runs",            label: "Most Runs",             unit: "runs" },
  { key: "battingAverage",  label: "Best Batting Average",  unit: "avg" },
  { key: "strikeRate",      label: "Best Strike Rate",      unit: "SR" },
  { key: "fours",           label: "Most Fours",            unit: "4s" },
  { key: "sixes",           label: "Most Sixes",            unit: "6s" }
];

const bowlingMetrics = [
  { key: "bowlingWickets",  label: "Most Wickets",          unit: "wkts" },
  { key: "economy",         label: "Best Economy (lower)",  unit: "econ" },
  { key: "bowlAverage",     label: "Best Bowling Average",  unit: "avg" },
  { key: "bowlStrikeRate",  label: "Best Bowling Strike Rate", unit: "SR" },
  { key: "bestBowling",     label: "Best Figures",          unit: "" }
];

const fieldingMetrics = [
  { key: "catches",   label: "Most Catches",   unit: "catches" },
  { key: "runouts",   label: "Most Run-outs",  unit: "RO" },
  { key: "stumpings", label: "Most Stumpings", unit: "stumpings" }
];

let currentMode = "batting"; // batting | bowling | fielding
let currentMetricKey = battingMetrics[0].key;
let leaderboardPlayers = [];
let allPlayersForSearch = [];

/* Load players JSON from players.html */
function loadPlayersDataFromPlayersPage() {
  return fetch("players.html")
    .then(res => res.text())
    .then(html => {
      const wrapper = document.createElement("div");
      wrapper.innerHTML = html;
      const script = wrapper.querySelector("#players-data");
      if (!script) return [];
      return JSON.parse(script.textContent || "[]");
    })
    .catch(() => []);
}

/* Build leaderboard object from players data */
function buildLeaderboardPlayers(playersData){
  return playersData.map(p => {
    const b = (p.stats && p.stats.batting) || {};
    const bw = (p.stats && p.stats.bowling) || {};
    const f = (p.stats && p.stats.fielding) || {};

    const innings = b.innings || 0;
    const notOuts = b.notOuts || 0;
    const dismissals = Math.max(innings - notOuts, 0);
    const battingAverage = dismissals > 0 ? (b.runs || 0) / dismissals : 0;
    const ballsFaced = b.balls || 0;
    const strikeRate = ballsFaced > 0 ? (b.runs || 0) * 100 / ballsFaced : 0;

    const ballsBowled = bw.balls || 0;
    const overs = ballsBowled / 6;
    const economy = overs > 0 ? (bw.runs || 0) / overs : 0;
    const bowlAverage = (bw.wickets || 0) > 0 ? (bw.runs || 0) / bw.wickets : 0;
    const bowlStrikeRate = (bw.wickets || 0) > 0 ? ballsBowled / bw.wickets : 0;

    return {
      name: p.name,
      role: p.roleText || "",
      team: p.team || "",
      photo: p.photo || DEFAULT_PHOTO,

      // Batting
      runs: b.runs || 0,
      fours: b.fours || 0,
      sixes: b.sixes || 0,
      battingAverage,
      strikeRate,

      // Bowling
      bowlingWickets: bw.wickets || 0,
      bowlingRuns: bw.runs || 0,
      bowlingBalls: ballsBowled,
      bestBowling: bw.best || "0/0",
      economy,
      bowlAverage,
      bowlStrikeRate,

      // Fielding
      catches: f.catches || 0,
      runouts: f.runouts || 0,
      stumpings: f.stumpings || 0
    };
  });
}

/* ----- HERO PLAYER SEARCH ----- */
function goToPlayerPage(name, team){
  if(!name) return;
  const url = "players.html?player=" + encodeURIComponent(name)
            + (team ? "&team=" + encodeURIComponent(team) : "");
  window.location.href = url;
}

function initTopPlayerSearch(playersData){
  const input = document.getElementById("home-player-search");
  const btn = document.getElementById("home-search-btn");
  const box = document.getElementById("home-search-suggestions");

  allPlayersForSearch = playersData.map(p => ({
    name: p.name,
    team: p.team || "Royal Jaguar Kings",
    photo: p.photo || DEFAULT_PHOTO
  }));

  function renderSuggestions(){
    const q = (input.value || "").trim().toLowerCase();
    box.innerHTML = "";
    if(!q){
      box.classList.remove("visible");
      return;
    }

    const matches = allPlayersForSearch.filter(p =>
      p.name.toLowerCase().includes(q)
    ).slice(0, 8);

    if(!matches.length){
      box.classList.remove("visible");
      return;
    }

    matches.forEach(p => {
      const item = document.createElement("div");
      item.className = "hero-suggestion-item";
      item.innerHTML = `
        <div class="hero-suggestion-photo">
          <img src="${p.photo}" alt="${p.name}">
        </div>
        <div class="hero-suggestion-text">
          <div class="hero-suggestion-name">${p.name}</div>
          <div class="hero-suggestion-team">${p.team}</div>
        </div>
      `;
      item.addEventListener("click", () => {
        goToPlayerPage(p.name, p.team);
      });
      box.appendChild(item);
    });

    box.classList.add("visible");
  }

  input.addEventListener("input", renderSuggestions);

  input.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      const firstSuggestion = box.querySelector(".hero-suggestion-item");
      if(firstSuggestion){
        const name = firstSuggestion.querySelector(".hero-suggestion-name")?.textContent || "";
        const team = firstSuggestion.querySelector(".hero-suggestion-team")?.textContent || "";
        goToPlayerPage(name, team);
      } else {
        const raw = (input.value || "").trim();
        if(raw){
          goToPlayerPage(raw, "");
        }
      }
    }
  });

  btn.addEventListener("click", () => {
    const firstSuggestion = box.querySelector(".hero-suggestion-item");
    if(firstSuggestion){
      const name = firstSuggestion.querySelector(".hero-suggestion-name")?.textContent || "";
      const team = firstSuggestion.querySelector(".hero-suggestion-team")?.textContent || "";
      goToPlayerPage(name, team);
    } else {
      const raw = (input.value || "").trim();
      if(raw){
        goToPlayerPage(raw, "");
      }
    }
  });

  // hide suggestions when clicking outside
  document.addEventListener("click", (e) => {
    if(!box.contains(e.target) && e.target !== input){
      box.classList.remove("visible");
    }
  });
}

/* ----- LEADERBOARD CONTROLS ----- */
function buildMetricSelect(){
  const metricSelect = document.getElementById("metric-select");
  metricSelect.innerHTML = "";

  let metrics;
  if (currentMode === "batting") metrics = battingMetrics;
  else if (currentMode === "bowling") metrics = bowlingMetrics;
  else metrics = fieldingMetrics;

  metrics.forEach((m, idx) => {
    const opt = document.createElement("option");
    opt.value = m.key;
    opt.textContent = m.label;
    metricSelect.appendChild(opt);

    if (idx === 0 && !metrics.some(x => x.key === currentMetricKey)) {
      currentMetricKey = m.key;
    }
  });

  metricSelect.value = currentMetricKey;
}

function renderLeaders(){
  const listEl = document.getElementById("leaders-list");
  const emptyEl = document.getElementById("leaders-empty");
  const titleEl = document.getElementById("leaders-title");
  const searchValue = (document.getElementById("leader-search").value || "").toLowerCase().trim();

  let metrics;
  if (currentMode === "batting") metrics = battingMetrics;
  else if (currentMode === "bowling") metrics = bowlingMetrics;
  else metrics = fieldingMetrics;

  const metric = metrics.find(m => m.key === currentMetricKey) || metrics[0];
  if (!metric) return;

  titleEl.textContent = metric.label;

  const list = leaderboardPlayers;

  const sorted = [...list].sort((a,b) => {
    const av = a[metric.key];
    const bv = b[metric.key];

    if (metric.key === "economy" || metric.key === "bowlAverage" || metric.key === "bowlStrikeRate") {
      const aa = (av || 0) > 0 ? av : 9999;
      const bb = (bv || 0) > 0 ? bv : 9999;
      return aa - bb;
    }

    if (metric.key === "bestBowling") {
      return 0;
    }

    return (bv || 0) - (av || 0);
  });

  let filtered;
  if (metric.key === "bestBowling") {
    filtered = sorted.filter(p => p.bestBowling && p.bestBowling !== "0/0");
  } else {
    filtered = sorted.filter(p => (p[metric.key] || 0) > 0);
  }

  if (searchValue){
    filtered = filtered.filter(p =>
      p.name.toLowerCase().includes(searchValue)
    );
  }

  listEl.innerHTML = "";

  if (filtered.length === 0){
    emptyEl.style.display = "block";
    return;
  }

  emptyEl.style.display = "none";

  filtered.slice(0, 20).forEach((player, idx) => {
    const row = document.createElement("div");
    row.className = "leader-row";

    const left = document.createElement("div");
    left.className = "leader-left";
    left.innerHTML = `
      <div class="leader-rank">${idx + 1}</div>
      <div class="leader-photo">
        <img src="${player.photo}" alt="${player.name}">
      </div>
      <div class="leader-text">
        <div class="leader-name">${player.name}</div>
        <div class="leader-role">${player.role}</div>
      </div>
    `;

    const right = document.createElement("div");
    right.className = "leader-right";

    let val = player[metric.key];
    if (metric.key === "bestBowling") {
      val = player.bestBowling || "-";
    } else if (metric.key === "battingAverage" ||
               metric.key === "strikeRate" ||
               metric.key === "economy" ||
               metric.key === "bowlAverage" ||
               metric.key === "bowlStrikeRate") {
      val = val ? val.toFixed(2) : "0.00";
    }

    right.innerHTML = `
      <div class="leader-value">${val}${metric.unit ? " " + metric.unit : ""}</div>
      <div class="leader-metric-label">${metric.label}</div>
    `;

    row.addEventListener("click", () => {
      goToPlayerPage(player.name, player.team);
    });

    row.appendChild(left);
    row.appendChild(right);
    listEl.appendChild(row);
  });
}

function initLeaderboardControls(){
  const modeSelect = document.getElementById("mode-select");
  const metricSelect = document.getElementById("metric-select");
  const searchInput = document.getElementById("leader-search");

  modeSelect.addEventListener("change", () => {
    currentMode = modeSelect.value;
    if (currentMode === "batting") currentMetricKey = battingMetrics[0].key;
    else if (currentMode === "bowling") currentMetricKey = bowlingMetrics[0].key;
    else currentMetricKey = fieldingMetrics[0].key;
    buildMetricSelect();
    renderLeaders();
  });

  metricSelect.addEventListener("change", () => {
    currentMetricKey = metricSelect.value;
    renderLeaders();
  });

  searchInput.addEventListener("input", () => {
    renderLeaders();
  });
}

/* INIT */
document.addEventListener("DOMContentLoaded", () => {
  initLeaderboardControls();

  loadPlayersDataFromPlayersPage().then(playersData => {
    leaderboardPlayers = buildLeaderboardPlayers(playersData || []);
    buildMetricSelect();
    renderLeaders();
    initTopPlayerSearch(playersData || []);
  });
});
</script>

</body>

</html>

